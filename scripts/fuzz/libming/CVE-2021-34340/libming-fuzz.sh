###
# @Author: Radon
# @Date: 2022-06-18 13:47:28
 # @LastEditors: Radon
 # @LastEditTime: 2022-10-24 23:07:09
# @Description: Hi, say something
###

###
# @description: afl fuzz libming
# @return {*}
###
afl() {
    export AFL=/home/radon/Documents/fuzzing/fuzzers/afl-2.52

    cd libming-2027b24f/obj-afl-2.52

    if [ "$1" == "S" ]; then
        gnome-terminal -t "secondary" -- bash -c "$AFL/afl-fuzz -S secondary -m none -k 120 -i in -o out$i ./util/swftophp @@" &
    elif [ "$1" == "M" ]; then
        $AFL/afl-fuzz -M main -m none -k 120 -i in -o out$i ./util/swftophp @@
    fi
}

###
# @description: aflgo fuzz libming
# @return {*}
###
aflgo() {
    export AFLGO=/home/radon/Documents/fuzzing/fuzzers/aflgo

    cd libming-2027b24f/obj-aflgo

    if [ "$1" == "S" ]; then
        gnome-terminal -t "secondary" -- bash -c "$AFLGO/afl-fuzz -S secondary -z exp -c 45m -m none -k 120 -i in -o out$i ./util/swftophp @@" &
    elif [ "$1" == "M" ]; then
        $AFLGO/afl-fuzz -M main -z exp -c 45m -m none -k 120 -i in -o out$i ./util/swftophp @@
    fi
}

###
# @description: myfuzz fuzz libming
# @return {*}
###
myfuzz() {
    export MYFUZZ=/home/radon/Documents/fuzzing/fuzzers/myfuzz-afl2.52b

    cd libming-2027b24f/obj-myfuzz-2.52

    if [ "$1" == "S" ]; then
        gnome-terminal -t "secondary" -- bash -c "$MYFUZZ/afl-fuzz -S secondary -m none -k 120 -i in -o out$i ./util/swftophp @@" &
    elif [ "$1" == "M" ]; then
        $MYFUZZ/afl-fuzz -M main -m none -k 120 -i in -o out$i ./util/swftophp @@
    fi
}

# Entry
# 第一个参数是表示用哪个工具进行测试
# 第二个参数是M或S, 表示是main进程还是secondary进程

if ! [[ "$2" != "M" || "$2" != "S" ]]; then
    echo "Invalid argument: $2."
    echo "Valid arguments: M, S."
    exit
fi

echo "$2 is valid, yeah!"

if [ "$1" == "afl" ]; then
    afl $2
elif [ "$1" == "aflgo" ]; then
    aflgo $2
elif [ "$1" == "myfuzz" ]; then
    myfuzz $2
else
    echo "Unknown fuzzer: $1"
    echo "Supported fuzzers: afl, aflgo, myfuzz"
fi
